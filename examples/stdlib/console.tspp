// Node.js-style console utilities library implemented in TSPP using syscalls
// Provides familiar console.log, console.error, console.warn, etc. functionality

// External syscall declarations
extern function tspp_sys_write(fd: int, buf: string, count: int): int;
extern function tspp_syscall1(number: int, arg1: int): int;
extern function tspp_syscall0(number: int): int;

// Standard file descriptors
const STDOUT_FILENO = 1;
const STDERR_FILENO = 2;

// Syscall numbers for time operations (Linux x86_64)
const SYS_gettimeofday = 96;
const SYS_time = 201;

// ANSI color codes for styled output
const RESET = "\x1b[0m";
const BRIGHT = "\x1b[1m";
const DIM = "\x1b[2m";
const RED = "\x1b[31m";
const GREEN = "\x1b[32m";
const YELLOW = "\x1b[33m";
const BLUE = "\x1b[34m";
const MAGENTA = "\x1b[35m";
const CYAN = "\x1b[36m";
const WHITE = "\x1b[37m";

// Background colors
const BG_RED = "\x1b[41m";
const BG_GREEN = "\x1b[42m";
const BG_YELLOW = "\x1b[43m";

// Helper function to get string length (simplified)
function getStringLength(str: string): int {
    // In a real implementation, we'd traverse the string to count characters
    // For now, we'll use a simplified approach
    return 100; // Simplified estimation for demo purposes
}

// Core write functions
function writeToStdout(message: string): void {
    let length = getStringLength(message);
    tspp_sys_write(STDOUT_FILENO, message, length);
}

function writeToStderr(message: string): void {
    let length = getStringLength(message);
    tspp_sys_write(STDERR_FILENO, message, length);
}

// Timestamp function (simplified)
function getCurrentTimestamp(): string {
    // In a real implementation, we'd use gettimeofday syscall
    // For now, return a placeholder
    return "[timestamp]";
}

// Console functions - Node.js style API (simplified without namespaces for compatibility)

// Basic logging functions
function console_log(message: string): void {
    // Node.js console.log equivalent
    writeToStdout(message);
    writeToStdout("\n");
}

function console_info(message: string): void {
    // Info output with icon
    writeToStdout(CYAN);
    writeToStdout("â„¹ ");
    writeToStdout(RESET);
    writeToStdout(message);
    writeToStdout("\n");
}

function console_warn(message: string): void {
    // Warning output to stderr with yellow color
    writeToStderr(YELLOW);
    writeToStderr("âš  ");
    writeToStderr(RESET);
    writeToStderr(message);
    writeToStderr("\n");
}

function console_error(message: string): void {
    // Error output to stderr with red color
    writeToStderr(RED);
    writeToStderr("âœ– ");
    writeToStderr(RESET);
    writeToStderr(message);
    writeToStderr("\n");
}

function console_debug(message: string): void {
    // Debug output with timestamp and dim styling
    writeToStdout(DIM);
    writeToStdout("ğŸ› ");
    writeToStdout(getCurrentTimestamp());
    writeToStdout(" ");
    writeToStdout(message);
    writeToStdout(RESET);
    writeToStdout("\n");
}

function console_trace(message: string): void {
    // Trace output with stack trace indicator
    writeToStdout(MAGENTA);
    writeToStdout("ğŸ“ Trace: ");
    writeToStdout(message);
    writeToStdout(RESET);
    writeToStdout("\n");
}

// Assertion function
function console_assert(condition: bool, message: string): void {
    if (!condition) {
        writeToStderr(BG_RED);
        writeToStderr(WHITE);
        writeToStderr("ASSERTION FAILED: ");
        writeToStderr(RESET);
        writeToStderr(RED);
        writeToStderr(message);
        writeToStderr(RESET);
        writeToStderr("\n");
    }
}

// Timer functions (simplified)
function console_time(label: string): void {
    writeToStdout(BLUE);
    writeToStdout("â± Timer '");
    writeToStdout(label);
    writeToStdout("' started");
    writeToStdout(RESET);
    writeToStdout("\n");
}

function console_timeEnd(label: string): void {
    writeToStdout(BLUE);
    writeToStdout("â± Timer '");
    writeToStdout(label);
    writeToStdout("' ended: [duration]ms");
    writeToStdout(RESET);
    writeToStdout("\n");
}

// Clear console (ANSI escape sequence)
function console_clear(): void {
    writeToStdout("\x1b[2J\x1b[H");
}

// Count function
function console_count(label: string): void {
    writeToStdout(GREEN);
    writeToStdout("ğŸ“Š ");
    writeToStdout(label);
    writeToStdout(": [count]");
    writeToStdout(RESET);
    writeToStdout("\n");
}

function console_countReset(label: string): void {
    writeToStdout(GREEN);
    writeToStdout("ğŸ“Š Counter '");
    writeToStdout(label);
    writeToStdout("' reset");
    writeToStdout(RESET);
    writeToStdout("\n");
}

// Group functions for nested output
let groupLevel = 0;

function console_group(label: string): void {
    // Simple grouping without loop (for compatibility)
    writeToStdout("â–¼ ");
    writeToStdout(label);
    writeToStdout("\n");
    groupLevel = groupLevel + 1;
}

function console_groupCollapsed(label: string): void {
    writeToStdout("â–¶ ");
    writeToStdout(label);
    writeToStdout("\n");
    groupLevel = groupLevel + 1;
}

function console_groupEnd(): void {
    if (groupLevel > 0) {
        groupLevel = groupLevel - 1;
    }
}

// Table function (simplified)
function console_table(title: string): void {
    writeToStdout("â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\n");
    writeToStdout("â”‚             ");
    writeToStdout(title);
    writeToStdout("              â”‚\n");
    writeToStdout("â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n");
}

// Process utilities
function process_exit(code: int): void {
    extern function tspp_sys_exit(status: int): int;
    tspp_sys_exit(code);
}

function process_getpid(): int {
    return tspp_syscall0(39); // SYS_getpid
}

// Global print utilities (Node.js style alternatives)
function print(message: string): void {
    writeToStdout(message);
}

function println(message: string): void {
    writeToStdout(message);
    writeToStdout("\n");
}

function printf(format: string): void {
    // Simplified printf implementation
    writeToStdout(format);
}

// Utility functions
function format(template: string): string {
    // Simplified formatting
    return template;
}

function inspect(obj: string): string {
    // Object inspection (simplified)
    return obj;
}